## 关于订阅
### 说明
- 为保证测试稳定性，当前连接的为公共mqtt服务器而非100.78.169.243
- 增加测试用部分，点击按钮向对应主题发信息，正式使用时改为v-if="0"即可
    ```
    <el-row v-if="1">
      测试：
      <el-button @click="test_1('temperature')">温度</el-button>
      <el-button @click="test_1('humidity')">湿度</el-button>
      <el-button @click="test_1('pressure')">气压</el-button>
    </el-row>
    ```
- 逻辑
  - 进入页面时进行初始化（连接mqtt，获取用户/订阅状态/历史记录）  
  - 按下确定按钮，调用接口，传三个主题订阅状态
  - 新订阅的主题初始内容为空
  - 订阅的主题收到信息后经处理调用接口传给后端
### 接口相关
- 初始化
  - 这些貌似登录时获取，因而目前写死未调接口 
    ```
        var initial = {
        user: '1234',           //用户--调接口时使用
        topics:[            //主题订阅情况与历史数据
          {
            state: 1,       //已订阅
            data:[          //历史记录接口传的信息数组
              {
                receive: '2023/12/14 00:00:00',   //接收时间
                time: '2014/02/13',         //如为2014-02-13在限制时间范围时会有bug
                labels:result.labels,       //标签    
                values:result.values,       //数值
                times: result.times,        //标签提取出时间
              },
              {
                receive: '2023/12/14 00:00:10',   //接收时间
                time: '2014/02/14',         //如为2014-02-13在限制时间范围时会有bug
                labels:result.labels,       //标签
                values:result.values,       //数值
                times: result.times,        //标签提取出时间
              },
            ],
          },
          {
            state: 0,       //未订阅
            data:[],
          },
          {
            state: 1,
            data:[
              {
                receive: '2023-12-14-00:00:00',   //接收时间
                time: '2014/02/13',         //如为2014-02-13在限制时间范围时会有bug
                labels:result.labels,       //标签    
                values:result.values,       //数值
                times: result.times,        //标签提取出时间
              },
            ],
          },
        ],
      };

    ```
- 订阅状态
  - 确定按钮
    ```
      axios.post('/weathersystem/subscribe/',{      //上传订阅状态
        user:that.user,       // 用户'1234'
        state:that.theme,     // 已订阅列表数组 例：[0,2] 表示已订阅温度气压，未订阅湿度   0-温度 1-湿度 2-气压
      });
    ```
    - 模拟接口：
    ```
        Mock.mock('/weathersystem/subscribe/', 'post',(options) =>{         //三个主题订阅状态
        console.log(options.body);
        return{
        };
    })
    ```
    - 例：
    ```
    {"user":"1234","state":[0,2,1]}
    ```
- 历史记录
  - 订阅后接收信息处理后的部分
    ```
        axios.post('/weathersystem/history/',{
          user:that.user,       // 用户'1234'
          topic:topic,          //主题 'temperature'  'humidity'  'pressure'
          data:{                //新接收信息（去除重复以后）
            receive: receivetime.toLocaleString(),   //接收时间
            time: result.time,          //如为2014-02-13在限制时间范围时会有bug
            labels:result.labels,       //横轴标签
            values:result.values,       //数值
            times: result.times,        //标签提取出时间
          }
        });
    ```
  - 模拟接口：
    ```
        Mock.mock('/weathersystem/history/', 'post',(options) =>{         //保存历史记录
        console.log(options.body);
        return{
        };
    })
    ```
    - 例：
    ```
    {"user":"1234",
    "topic":"humidity",
    "data":{"receive":"2023/12/30 00:55:33","time":"2014/02/13","labels":["2014-02-13T00:00:00","2014-02-13T00:20:00","2014-02-13T00:50:00","2014-02-13T01:00:00","2014-02-13T01:20:00","2014-02-13T01:50:00","2014-02-13T02:00:00","2014-02-13T02:20:00","2014-02-13T02:50:00","2014-02-13T03:00:00","2014-02-13T03:20:00","2014-02-13T03:50:00","2014-02-13T04:00:00","2014-02-13T04:20:00","2014-02-13T04:50:00","2014-02-13T05:00:00","2014-02-13T05:20:00","2014-02-13T05:50:00","2014-02-13T06:00:00","2014-02-13T06:20:00","2014-02-13T06:50:00","2014-02-13T07:00:00","2014-02-13T07:20:00","2014-02-13T07:50:00","2014-02-13T08:00:00","2014-02-13T08:20:00","2014-02-13T08:50:00","2014-02-13T09:00:00","2014-02-13T09:20:00","2014-02-13T09:50:00","2014-02-13T10:00:00","2014-02-13T10:20:00","2014-02-13T10:50:00","2014-02-13T11:00:00","2014-02-13T11:20:00","2014-02-13T11:50:00","2014-02-13T12:00:00","2014-02-13T12:20:00","2014-02-13T12:50:00","2014-02-13T13:00:00","2014-02-13T13:20:00","2014-02-13T13:50:00","2014-02-13T14:20:00","2014-02-13T14:50:00","2014-02-13T15:00:00","2014-02-13T15:20:00","2014-02-13T15:50:00","2014-02-13T16:00:00","2014-02-13T16:20:00","2014-02-13T16:50:00","2014-02-13T17:00:00","2014-02-13T17:20:00","2014-02-13T17:50:00","2014-02-13T18:00:00","2014-02-13T18:20:00","2014-02-13T18:50:00","2014-02-13T19:00:00","2014-02-13T19:20:00","2014-02-13T19:50:00","2014-02-13T20:20:00","2014-02-13T20:50:00","2014-02-13T21:00:00","2014-02-13T21:20:00","2014-02-13T21:50:00","2014-02-13T22:00:00","2014-02-13T22:20:00","2014-02-13T22:50:00","2014-02-13T23:00:00","2014-02-13T23:20:00","2014-02-13T23:50:00"],
    "values":["4","4.0","4.0","4","4.0","4.0","3","3.0","3.0","3","3.0","2.0","2","2.0","2.0","2","2.0","2.0","2","3.0","3.0","3","3.0","3.0","3","4.0","4.0","4","4.0","4.0","4","5.0","5.0","6","6.0","6.0","6","6.0","6.0","6","6.0","7.0","7.0","7.0","6","6.0","6.0","6","6.0","5.0","5","5.0","5.0","5","5.0","4.0","4","4.0","4.0","4.0","3.0","3","3.0","4.0","4","3.0","3.0","3","3.0","2.0"],
    "times":["00:00:00","00:20:00","00:50:00","01:00:00","01:20:00","01:50:00","02:00:00","02:20:00","02:50:00","03:00:00","03:20:00","03:50:00","04:00:00","04:20:00","04:50:00","05:00:00","05:20:00","05:50:00","06:00:00","06:20:00","06:50:00","07:00:00","07:20:00","07:50:00","08:00:00","08:20:00","08:50:00","09:00:00","09:20:00","09:50:00","10:00:00","10:20:00","10:50:00","11:00:00","11:20:00","11:50:00","12:00:00","12:20:00","12:50:00","13:00:00","13:20:00","13:50:00","14:20:00","14:50:00","15:00:00","15:20:00","15:50:00","16:00:00","16:20:00","16:50:00","17:00:00","17:20:00","17:50:00","18:00:00","18:20:00","18:50:00","19:00:00","19:20:00","19:50:00","20:20:00","20:50:00","21:00:00","21:20:00","21:50:00","22:00:00","22:20:00","22:50:00","23:00:00","23:20:00","23:50:00"]}
    }
    ```